(this["webpackJsonplinz-address-import-homepage"]=this["webpackJsonplinz-address-import-homepage"]||[]).push([[0],{50:function(e,t,n){},51:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n(20),c=n.n(a),s=n(1),i=n(0),o={PERFECT:[1,"Data is already perfect","No action required"],EXISTS_BUT_WRONG_DATA:[2,"Address exists but the data is wrong","Select a suburb in the tool","data-wrong.txt"],EXISTS_BUT_NO_LINZ_REF:[3,"Address exists but no linz ref","Select a suburb in the tool","needs-linz-ref.txt"],MULTIPLE_EXIST_BUT_NO_LINZ_REF:[4,"Multiple addresses exists, none have linz ref","manual action required","needs-linz-ref-but-multiple.txt"],MULTIPLE_EXIST:[5,"Multiple addresses exists with same linz ref","manual action required","duplicate-linz-ref.txt"],EXISTS_BUT_LOCATION_WRONG:[6,"Addresses exist but location is very wrong",'Select the suburb called "ZZ Special Location Wrong".',"location-wrong.txt"],TOTALLY_MISSING:[7,"Addresses totally missing from OSM","Select a suburb in the tool"],NEEDS_DELETE:[8,"Addresses in OSM that have been deleted by LINZ","Select a suburb in the tool","needs-delete.txt"],NEEDS_DELETE_NON_TRIVIAL:[9,"Addresses in OSM that have been deleted by LINZ, but are on a OSM business/POI","manual action required","needs-delete-non-trivial.txt"],CORRUPT:[10,"There are multiple LINZ refs on the same OSM node","manual action required","corrupt.txt"],LINZ_REF_CHANGED:[11,"LINZ has changed their ID for an address, but not the data","Select the suburb called 'ZZ Special Linz Ref Changed'","linz-ref-changed.txt"],COULD_BE_STACKED:[13,"Addresses in OSM that are perfect, but the flats/units could be stacked if this is desired.","N/A. Just for statistics","could-be-stacked.txt"],NEEDS_DELETE_ON_BUILDING:[14,"Addresses in OSM that have been deleted by LINZ, but are on a OSM building","Select a suburb in the tool","needs-delete-on-building.txt"],REPLACED_BY_BUILDING:[15,"Addresses in OSM that exist twice - once on a building and once on an imported node","Select a suburb in the tool","replaced-by-building.txt"]},l="https://linz-addr-cdn.kyle.kiwi",u=function(){var e=Object(s.useState)(),t=Object(r.a)(e,2),n=t[0],a=t[1],c=Object(s.useState)(),u=Object(r.a)(c,2),d=u[0],j=u[1];if(Object(s.useEffect)((function(){fetch("".concat(l,"/stats.json")).then((function(e){return e.json()})).then(j).catch(a)}),[]),n)return Object(i.jsx)(i.Fragment,{children:"Error."});if(!d)return Object(i.jsx)(i.Fragment,{children:"Loading..."});var b=new Date(d.date),h=Math.round((+new Date-+b)/1e3/60/60);return Object(i.jsxs)("div",{style:{margin:15},children:[Object(i.jsx)("a",{href:"./RapiD/",className:"start",children:"\u2728 Click to start mapping!"}),Object(i.jsxs)("table",{className:"busy",children:[Object(i.jsx)("thead",{children:Object(i.jsxs)("tr",{style:{fontWeight:600},children:[Object(i.jsx)("td",{children:"Code"}),Object(i.jsx)("td",{children:"Data Category"}),Object(i.jsx)("td",{children:"No. of addresses"}),Object(i.jsx)("td",{children:"Percentage of total"}),Object(i.jsx)("td",{children:"How to action"}),Object(i.jsx)("td",{children:"Raw data"})]})}),Object(i.jsx)("tbody",{children:Object.entries(d.count).map((function(e){var t=Object(r.a)(e,2),n=t[0],a=t[1],c=Object(r.a)(o[n],4),s=c[0],u=c[1],j=c[2],b=c[3];return Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:s}),Object(i.jsx)("td",{children:u}),Object(i.jsx)("td",{children:a.toLocaleString("en-nz")}),Object(i.jsxs)("td",{children:[(a/d.total*100).toFixed(2),"%"]}),Object(i.jsx)("td",{children:j}),b&&Object(i.jsx)("td",{children:Object(i.jsx)("a",{href:"".concat(l,"/").concat(b),children:"download"})})]})}))})]}),Object(i.jsxs)("p",{style:{margin:12},children:["Statistics last updated on ",b.toLocaleString("en-nz")," (",h," hours ago)"]}),Object(i.jsxs)("footer",{children:["For more infomation, see:",Object(i.jsxs)("ul",{children:[Object(i.jsx)("li",{children:Object(i.jsx)("a",{href:"https://wiki.openstreetmap.org/wiki/Import/New_Zealand_Street_Addresses_(2021)",children:"the wiki page"})}),Object(i.jsx)("li",{children:Object(i.jsx)("a",{href:"https://github.com/osm-nz/linz-address-import",children:"the repository containing the source code"})}),Object(i.jsx)("li",{children:Object(i.jsx)("a",{href:"https://osmcha.org/?aoi=5a4d6cbe-37f9-4b5b-a6d6-0c69dd488a07",children:"All changesets uploaded so far"})}),Object(i.jsx)("li",{children:Object(i.jsx)("a",{href:"https://github.com/osm-nz/linz-address-import/issues/1",children:"The import progress"})}),Object(i.jsx)("li",{children:Object(i.jsx)("a",{href:"#/map",children:"A map of all the sectors requiring attention"})})]})]})]})},d=n(53),j=n(54),b=n(55);var h=n(10),O=function(e,t){return Object(h.a)(new Map(t.map((function(t){return[t[e],t]}))).values())},f=(n(27),n(52)),p=n(57),x=function(){return Object(i.jsxs)(f.a,{position:"topright",children:[Object(i.jsx)(f.a.BaseLayer,{checked:!0,name:"OpenStreetMap",children:Object(i.jsx)(p.a,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"})}),Object(i.jsx)(f.a.BaseLayer,{name:"LINZ Aerial Imagery",children:Object(i.jsx)(p.a,{attribution:'<a href="https://www.linz.govt.nz/data/licensing-and-using-data/attributing-elevation-or-aerial-imagery-data">Sourced from LINZ CC-BY 4.0</a>',url:"https://basemaps.linz.govt.nz/v1/tiles/aerial/EPSG:3857/{z}/{x}/{y}.jpg?api=d01egend5f8dv4zcbfj6z2t7rs3"})}),Object(i.jsx)(f.a.BaseLayer,{name:"LINZ Topo50",children:Object(i.jsx)(p.a,{attribution:'<a href="https://www.linz.govt.nz/data/licensing-and-using-data/attributing-elevation-or-aerial-imagery-data">Sourced from LINZ CC-BY 4.0</a>',url:"https://map.cazzaserver.com/linz_topo/{z}/{x}/{y}.png"})})]})},m=(n(37),"https://linz-addr-cdn.kyle.kiwi"),g=!!window.opener;function v(e){return e>1e3?"#3a0000":e>500?"#67001f":e>200?"#980043":e>100?"#ce1256":e>60?"#e7298a":e>40?"#df65b0":e>20?"#c994c7":"#d4b9da"}function y(e,t){return{color:t?"#aaaaaa":v(e.totalCount),fillOpacity:.3,opacity:1,stroke:!0,weight:2}}var w="orange";function k(e,t){t?(w=e.target.options.color,e.target.setStyle({color:"yellow"})):e.target.setStyle({color:w})}function S(e){var t=Object(r.a)(e,2),n=Object(r.a)(t[0],2),a=n[0],c=n[1],s=Object(r.a)(t[1],2),i=s[0],o=s[1];return[[o,a],[o,i],[c,i],[c,a]]}var L={Expires:"Tue, 01 Jan 1980 1:00:00 GMT","Cache-Control":"no-cache, no-store, max-age=0",Pragma:"no-cache"},_=function(){var e=Object(s.useState)(!1),t=Object(r.a)(e,2),n=t[0],a=t[1],c=Object(s.useState)(),o=Object(r.a)(c,2),l=o[0],u=o[1],h=Object(s.useState)(),f=Object(r.a)(h,2),p=f[0],w=f[1],_=Object(s.useState)(),I=Object(r.a)(_,2),N=I[0],C=I[1];if(Object(s.useEffect)((function(){Promise.all([fetch("".concat(m,"/index.json?nocache=").concat(Math.random()),{headers:L}).then((function(e){return e.json()})),fetch("".concat(m,"/__locked?nocache=").concat(Math.random()),{headers:L}).then((function(e){return e.json()})).catch((function(){return{}}))]).then(C).catch(w)}),[]),p)return Object(i.jsx)(i.Fragment,{children:"Error"});if(!N)return Object(i.jsx)(i.Fragment,{children:"Loading..."});var E=O("name",N[0].results.map((function(e){return{name:e.name.split(" - ")[0],isPreview:"/Categories/Preview"===e.groupCategories[0]}})).filter((function(e){return n||!e.isPreview}))),F=function(e){return N[1][e.id]?"Someone else ".concat("done"===N[1][e.id][1]?"may have already uploaded":"is working on"," this dataset! Check back in one day."):""};return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("div",{style:{height:200},children:[g&&Object(i.jsxs)("div",{style:{textAlign:"center"},children:[Object(i.jsx)("h3",{style:{margin:0},children:"Please select a suburb to edit"}),"You can close this page and use the list if you prefer"]}),Object(i.jsx)("input",{type:"checkbox",checked:n,onChange:function(e){return a(e.target.checked)}}),"Show Preview Layers",Object(i.jsx)("br",{}),Object(i.jsx)("br",{}),Object(i.jsx)("div",{style:{display:"flex",flexWrap:"wrap"},children:E.map((function(e){return Object(i.jsx)("button",{type:"button",className:[l===e.name?"active-layer":"inactive-layer",e.isPreview?"preview-layer":""].join(" "),onClick:function(){return u(e.name)},children:e.name},e.name)}))})]}),Object(i.jsxs)(d.a,{style:{width:"100vw",height:"calc(100vh - 200px)"},center:[-40.98,166.9],zoom:6,scrollWheelZoom:!0,children:[Object(i.jsx)(x,{}),l&&N[0].results.filter((function(e){return e.name.startsWith(l)})).map((function(e){return Object(i.jsx)(j.a,{pathOptions:y(e,N[1][e.id]),positions:S(e.extent),eventHandlers:{click:function(){g&&function(e,t){if(t){var n=Object(r.a)(t,2),a=n[0],c=n[1],s="Check back in a day.\n\nIf you continue, you might override or duplicate their work!",i="done"===c?"This dataset may already have been uploaded by someone else! ".concat(s):"Someone else (".concat(a,") started editing this dataset ").concat(c," minutes ago. ").concat(s);if(!confirm(i))return}window.opener.postMessage("ADD_SECTOR=".concat(e)),window.close()}(e.id,N[1][e.id])},mouseover:function(e){return k(e,!0)},mouseout:function(e){return k(e,!1)}},children:Object(i.jsxs)(b.a,{direction:"bottom",sticky:!0,children:[Object(i.jsx)("strong",{children:e.name}),Object(i.jsx)("br",{}),e.snippet,Object(i.jsx)("br",{}),F(e)]})})})),Object(i.jsxs)("div",{className:"legend leaflet-bottom leaflet-left",style:{margin:20},children:[Object(i.jsx)("strong",{children:"# of changes"}),Object(i.jsx)("br",{}),[0,20,40,60,100,200,500,1e3].map((function(e,t,n){return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("i",{style:{background:v(n[t]+1)}}),n[t],n[t+1]?Object(i.jsxs)(i.Fragment,{children:["\u2013",n[t+1],Object(i.jsx)("br",{})]}):"+"]})}))]})]})]})},I=n(3),N=n.n(I),C=n(6),E=n(5),F=Object(s.createContext)({}),z=function(e){var t=e.children,n=Object(s.useState)(),a=Object(r.a)(n,2),c=a[0],o=a[1],l=Object(s.useState)(!1),u=Object(r.a)(l,2),d=u[0],j=u[1],b=Object(s.useState)(Object(E.isLoggedIn)()),h=Object(r.a)(b,2),O=h[0],f=h[1],p=Object(s.useState)(),x=Object(r.a)(p,2),m=x[0],g=x[1];Object(s.useEffect)((function(){O&&Object(E.getUser)("me").then(g).catch(o)}),[O]);var v=Object(s.useCallback)(Object(C.a)(N.a.mark((function e(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,j(!0),e.next=4,Object(E.login)({clientId:"127.0.0.1"===window.location.hostname?"oPbyNuXQIEh8ZI3zbjVWVmVyIaNB2guU6uLP2gQ3sfs":"ZkRBVnOoBeMgwSajgG7E2bhgP5bR61knGYxsh9KKaHc",mode:"popup",redirectUrl:"127.0.0.1"===window.location.hostname?"http://127.0.0.1:3000/land.html":"https://osm-nz.github.io/land.html",scopes:["read_prefs","write_api","write_notes"]});case 4:f(!0),j(!1),o(void 0),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),o(e.t0),j(!1);case 13:case"end":return e.stop()}}),e,null,[[0,9]])}))),[]),y=Object(s.useCallback)((function(){Object(E.logout)(),f(!1),g(void 0),o(void 0)}),[]),w=Object(s.useMemo)((function(){return{user:m,logout:y}}),[m,y]);return c?Object(i.jsxs)(i.Fragment,{children:["Failed to login!",Object(i.jsx)("br",{}),"".concat(c),Object(i.jsx)("br",{}),Object(i.jsx)("button",{type:"button",onClick:v,children:"Try Again"}),Object(i.jsx)("button",{type:"button",onClick:y,children:"Logout"})]}):d?Object(i.jsx)(i.Fragment,{children:"Login in progress... (use the popup window)"}):O?m?Object(i.jsx)(F.Provider,{value:w,children:t}):Object(i.jsx)(i.Fragment,{children:"Loading..."}):Object(i.jsxs)(i.Fragment,{children:["You need to login to use this feature",Object(i.jsx)("br",{}),Object(i.jsx)("button",{type:"button",onClick:v,children:"Login"})]})},T=n(56);var D=function(e){var t=e.diff,n=Object(s.useRef)(null),r=function(e){var t={minLat:1/0,minLng:1/0,maxLat:-1/0,maxLng:-1/0};return Object.values(e).flat().filter((function(e){return"node"===e.type})).forEach((function(e){e.lat<t.minLat&&(t.minLat=e.lat),e.lon<t.minLng&&(t.minLng=e.lon),e.lat>t.maxLat&&(t.maxLat=e.lat),e.lon>t.maxLng&&(t.maxLng=e.lon)})),t}(t);return Object(i.jsxs)(d.a,{style:{width:500,height:500},scrollWheelZoom:!0,whenCreated:function(e){return e.fitBounds(n.current.getBounds())},children:[Object(i.jsx)(x,{}),Object(i.jsx)(T.a,{ref:n,children:Object(i.jsx)(j.a,{positions:[[r.maxLat,r.minLng],[r.maxLat,r.maxLng],[r.minLat,r.maxLng],[r.minLat,r.minLng]]})})]})},R=n(16),A=n(4),M=n(12);function P(){return(P=Object(C.a)(N.a.mark((function e(t){var n,r,a,c,s,i,o,l,u,d,j,b,O,f,p,x,m,g,v,y,w,k,S,L,_,I,C,F,z,T,D,P,Z,B,U,H,G,W,q;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={added:{},removed:{},featureDeleted:{},changed:{}},r=Object(M.a)(t.create);try{for(r.s();!(a=r.n()).done;)if((c=a.value).tags)for(s in c.tags)l=c.tags[s],(i=n.added)[s]||(i[s]={}),(o=n.added[s])[l]||(o[l]=0),n.added[s][l]+=1}catch(N){r.e(N)}finally{r.f()}u=Object(M.a)(t.delete);try{for(u.s();!(d=u.n()).done;)if((j=d.value).tags)for(b in j.tags)p=j.tags[b],(O=n.featureDeleted)[b]||(O[b]={}),(f=n.featureDeleted[b])[p]||(f[p]=0),n.featureDeleted[b][p]+=1}catch(N){u.e(N)}finally{u.f()}if(x=t.modify.reduce((function(e,t){return Object(A.a)(Object(A.a)({},e),{},Object(R.a)({},t.type,[].concat(Object(h.a)(e[t.type]||[]),[t.id])))}),{}),e.t0=[],e.t1=h.a,!x.node){e.next=14;break}return e.next=11,Object(E.getFeatures)("node",x.node);case 11:e.t2=e.sent,e.next=15;break;case 14:e.t2=[];case 15:if(e.t3=e.t2,e.t4=(0,e.t1)(e.t3),e.t5=h.a,!x.way){e.next=24;break}return e.next=21,Object(E.getFeatures)("way",x.way);case 21:e.t6=e.sent,e.next=25;break;case 24:e.t6=[];case 25:if(e.t7=e.t6,e.t8=(0,e.t5)(e.t7),e.t9=h.a,!x.relation){e.next=34;break}return e.next=31,Object(E.getFeatures)("relation",x.relation);case 31:e.t10=e.sent,e.next=35;break;case 34:e.t10=[];case 35:e.t11=e.t10,e.t12=(0,e.t9)(e.t11),m=e.t0.concat.call(e.t0,e.t4,e.t8,e.t12),g={},v=Object(M.a)(m);try{for(v.s();!(y=v.n()).done;)w=y.value,g[w.type+w.id]=w}catch(N){v.e(N)}finally{v.f()}k=Object(M.a)(t.modify);try{for(k.s();!(S=k.n()).done;)for(L=S.value,_=g[L.type+L.id].tags||{},I=L.tags||{},C=Object.keys(Object(A.a)(Object(A.a)({},_),I)),F=0,z=C;F<z.length;F++)T=z[F],I[T]&&!_[T]?(Z=I[T],(D=n.added)[T]||(D[T]={}),(P=n.added[T])[Z]||(P[Z]=0),n.added[T][Z]+=1):!I[T]&&_[T]?(H=_[T],(B=n.removed)[T]||(B[T]={}),(U=n.removed[T])[H]||(U[H]=0),n.removed[T][H]+=1):I[T]!==_[T]&&(q="".concat(_[T]," ~~> ").concat(I[T]),(G=n.changed)[T]||(G[T]={}),(W=n.changed[T])[q]||(W[q]=0),n.changed[T][q]+=1)}catch(N){k.e(N)}finally{k.f()}return e.abrupt("return",n);case 44:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=function(e,t,n){return Object.entries(e).map((function(e){var a=Object(r.a)(e,2),c=a[0],s=a[1],o=Object.entries(s);return Object(i.jsxs)("li",{style:{color:n},children:[t," ",Object(i.jsxs)("code",{children:[c,"="]}),o.length>1?Object(i.jsx)("ul",{children:o.map((function(e){var t=Object(r.a)(e,2),n=t[0],a=t[1];return Object(i.jsxs)("li",{children:[Object(i.jsx)("code",{children:n})," ",a>1&&"(".concat(a,")")]},n)}))}):Object(i.jsx)("code",{children:o[0][0]})]},t+c)}))},B=function(e){var t=e.diff,n=Object(s.useState)(),a=Object(r.a)(n,2),c=a[0],o=a[1],l=Object(s.useState)(),u=Object(r.a)(l,2),d=u[0],j=u[1];return Object(s.useEffect)((function(){(function(e){return P.apply(this,arguments)})(t).then(j).catch(o)}),[t]),c?Object(i.jsx)(i.Fragment,{children:"Failed to calculate tag changes"}):d?(console.log("c",d),Object(i.jsxs)("ul",{children:[Z(d.added,"Added","green"),Z(d.changed,"Changed","orange"),Z(d.removed,"Removed","red"),Z(d.featureDeleted,"Deleted","maroon")]})):Object(i.jsx)(i.Fragment,{children:"Loading tag changes..."})},U=function(e){var t=e.diff;return Object(i.jsxs)("div",{style:{padding:4,color:"#fff"},children:[Object(i.jsxs)("span",{style:{background:"#4caf50",padding:4},children:["+",t.create.length]}),Object(i.jsx)("span",{style:{background:"#ff9800",padding:4},children:t.modify.length}),Object(i.jsxs)("span",{style:{background:"#f44336",padding:4},children:["-",t.delete.length]})]})},H={attribution:"https://wiki.openstreetmap.org/wiki/Contributors#LINZ",created_by:"LINZ Data Import 1.1.1",locale:navigator.language,source:"https://wiki.osm.org/LINZ",comment:""},G=function(e){return new Promise((function(t){var n=new FileReader;n.readAsText(e,"UTF-8"),n.onloadend=function(){return t(n.result)}}))};function W(e){try{return Object.fromEntries(e.split("\n").map((function(e){if(!e)return[];var t=e.split("="),n=Object(r.a)(t,2),a=n[0],c=n[1];return[a.trim(),c.trim()]})).filter((function(e){var t=Object(r.a)(e,2),n=t[0],a=t[1];return n&&a})))}catch(t){return}}var q=function(e){return Object.entries(e).map((function(e){return e.join("=")})).join("\n")},X=function(){var e=Object(s.useContext)(F),t=e.user,n=e.logout,a=Object(s.useState)(!1),c=Object(r.a)(a,2),o=c[0],l=c[1],u=Object(s.useState)(),d=Object(r.a)(u,2),j=d[0],b=d[1],h=Object(s.useState)(),O=Object(r.a)(h,2),f=O[0],p=O[1],x=Object(s.useState)(q(H)),m=Object(r.a)(x,2),g=m[0],v=m[1],y=Object(s.useState)(),w=Object(r.a)(y,2),k=w[0],S=w[1],L=W(g);function _(){return(_=Object(C.a)(N.a.mark((function e(t){var n,r;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===t||void 0===t?void 0:t.length){e.next=2;break}return e.abrupt("return",S(void 0));case 2:return e.next=4,G(t[0]);case 4:return n=e.sent,r=Object(E.parseOsmChangeXml)(n),e.abrupt("return",S(r));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){return(I=Object(C.a)(N.a.mark((function e(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(void 0),b(void 0),l(!0),e.prev=3,e.t0=p,e.next=7,Object(E.uploadChangeset)(L,k);case 7:e.t1=e.sent,(0,e.t0)(e.t1),e.next=14;break;case 11:e.prev=11,e.t2=e.catch(3),b(e.t2);case 14:l(!1);case 15:case"end":return e.stop()}}),e,null,[[3,11]])})))).apply(this,arguments)}return o?Object(i.jsx)(i.Fragment,{children:"Uploading..."}):Object(i.jsxs)(i.Fragment,{children:[j&&Object(i.jsx)("strong",{children:"".concat(j)}),f&&Object(i.jsxs)("strong",{children:["Uploaded! ",Object(i.jsx)("a",{href:"https://osm.org/changeset/".concat(f),children:f})]}),Object(i.jsx)("br",{}),Object(i.jsx)("br",{}),"Logged in as ",Object(i.jsx)("code",{children:t.display_name}),"."," ",Object(i.jsx)("button",{type:"button",onClick:n,children:"Logout"}),Object(i.jsx)("br",{}),Object(i.jsx)("br",{}),Object(i.jsx)("strong",{children:"Upload OSM Change file:"}),Object(i.jsx)("br",{}),Object(i.jsx)("input",{type:"file",accept:".osc",onChange:function(e){return function(e){return _.apply(this,arguments)}(e.target.files)}}),k&&Object(i.jsx)("button",{type:"button",onClick:function(){document.querySelector("input[type=file]").value="",S(void 0)},children:"Clear"}),Object(i.jsx)("br",{}),Object(i.jsx)("br",{}),Object(i.jsx)("strong",{children:"Changeset Tags:"}),Object(i.jsx)("br",{}),Object(i.jsx)("textarea",{value:g,onChange:function(e){return v(e.target.value)},onBlur:function(e){var t=W(e.target.value);t&&v(q(t))},style:{width:500,height:200,color:L?"black":"red"}}),Object(i.jsx)("br",{}),Object(i.jsx)("br",{}),k?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(U,{diff:k}),Object(i.jsx)("strong",{children:"Approximate Extent of nodes:"}),Object(i.jsx)("br",{}),Object(i.jsx)(D,{diff:k}),Object(i.jsx)("br",{}),Object(i.jsx)("br",{}),Object(i.jsx)("strong",{children:"Tag Changes:"}),Object(i.jsx)("br",{}),Object(i.jsx)(B,{diff:k}),Object(i.jsx)("br",{}),Object(i.jsx)("br",{}),Object(i.jsx)("button",{type:"button",onClick:function(){return I.apply(this,arguments)},disabled:!(null===L||void 0===L?void 0:L.comment),style:{fontSize:32},children:"Upload"})]}):Object(i.jsxs)(i.Fragment,{children:["Upload a ",Object(i.jsx)("code",{children:".osc"})," file to see the remaining options"]})]})},V=function(){return Object(i.jsx)(z,{children:Object(i.jsx)(X,{})})},Y=function(){return Object(i.jsx)(i.Fragment,{children:"Hello!"})},J=window.location.origin+window.location.pathname+window.location.hash;function K(e){return Q.apply(this,arguments)}function Q(){return(Q=Object(C.a)(N.a.mark((function e(t){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(E.uploadChangeset)({comment:"Restore deleted features",created_by:"HistoryRestorer",host:J},{create:[],modify:t.map((function(e){return Object(A.a)(Object(A.a)({},e.newFeature),{},{id:e.oldId,version:e.oldVersion})})),delete:t.map((function(e){return e.newFeature}))}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $={n:"node",w:"way",r:"relation"},ee=fetch("https://cdn.jsdelivr.net/gh/openstreetmap/id-tagging-schema@main/dist/presets.min.json").then((function(e){return e.json()})),te=fetch("https://cdn.jsdelivr.net/gh/openstreetmap/id-tagging-schema@main/dist/translations/en.min.json").then((function(e){return e.json()}));function ne(e){return re.apply(this,arguments)}function re(){return(re=Object(C.a)(N.a.mark((function e(t){var n,a,c,s,i,o,l,u,d,j;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return","No Tags");case 2:return e.next=4,ee;case 4:return c=e.sent,e.next=7,te;case 7:for(o in s=e.sent,i=[],c)l=c[o],u=l.matchScore,d=l.tags,Object.keys(d).length&&Object.entries(d).every((function(e){var n=Object(r.a)(e,2),a=n[0],c=n[1];return a in t&&("*"===c||c===t[a])}))&&i.push({presetId:o,matchScore:(null!==u&&void 0!==u?u:1)+Object.values(d).filter((function(e){return"*"!==e})).length/10});return i.sort((function(e,t){return t.matchScore-e.matchScore})),j=null===(n=i[0])||void 0===n?void 0:n.presetId,e.abrupt("return",(null===(a=s.en.presets.presets[j])||void 0===a?void 0:a.name)||"Unknown");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ae=function(e){return(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.ref)||(null===e||void 0===e?void 0:e.official_name)||(null===e||void 0===e?void 0:e.alt_name)||(null===e||void 0===e?void 0:e.loc_name)||(null===e||void 0===e?void 0:e["addr:housename"])||(null===e||void 0===e?void 0:e["seamark:name"])};function ce(e){return se.apply(this,arguments)}function se(){return se=Object(C.a)(N.a.mark((function e(t){var n,r,a,c,s,i,o,l,u,d,j,b;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}throw new Error("No data entered");case 2:if(!t.some((function(e){return!e.fromId||!e.toId}))){e.next=4;break}throw new Error("Some fields are blank");case 4:n={node:t.filter((function(e){return"n"===e.type})).map((function(e){return e.toId})),way:t.filter((function(e){return"w"===e.type})).map((function(e){return e.toId})),relation:t.filter((function(e){return"r"===e.type})).map((function(e){return e.toId}))},r=Object(M.a)(t),e.prev=6,r.s();case 8:if((a=r.n()).done){e.next=21;break}return c=a.value,s=$[c.type],e.next=13,Object(E.getFeatureHistory)(s,c.fromId);case 13:if(i=e.sent,o=i.slice(-1)[0],l=i.slice(-2)[0],!1===o.visible){e.next=18;break}throw new Error("".concat(s," ").concat(c.fromId," is not deleted"));case 18:n[s].push("".concat(c.fromId,"v").concat(l.version));case 19:e.next=8;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(6),r.e(e.t0);case 26:return e.prev=26,r.f(),e.finish(26);case 29:u=[],e.t1=N.a.keys(n);case 31:if((e.t2=e.t1()).done){e.next=45;break}if(d=e.t2.value,!(j=n[d]).length){e.next=43;break}return e.t3=u.push,e.t4=u,e.t5=h.a,e.next=40,Object(E.getFeatures)(d,j);case 40:e.t6=e.sent,e.t7=(0,e.t5)(e.t6),e.t3.apply.call(e.t3,e.t4,e.t7);case 43:e.next=31;break;case 45:return b={},e.abrupt("return",Promise.all(t.map(function(){var e=Object(C.a)(N.a.mark((function e(t){var n,r,a,c;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!1,b[t.type+t.fromId]&&(r="Duplicate deleted feature"),b[t.type+t.toId]&&(r="Duplicate new feature"),(a=u.find((function(e){return e.type===$[t.type]&&e.id===t.fromId})))||(r="Invalid old feature"),(c=u.find((function(e){return e.type===$[t.type]&&e.id===t.toId})))||(r="Invalid new feature"),e.next=9,ne(null===a||void 0===a?void 0:a.tags);case 9:return e.t0=e.sent,e.t1=ae(null===a||void 0===a?void 0:a.tags),e.next=13,ne(null===c||void 0===c?void 0:c.tags);case 13:return e.t2=e.sent,e.t3=ae(null===c||void 0===c?void 0:c.tags),e.t4=c,e.t5=null===a||void 0===a?void 0:a.id,e.t6=(null!==(n=null===a||void 0===a?void 0:a.version)&&void 0!==n?n:-2)+1,e.t7=r,e.abrupt("return",{oldPreset:e.t0,oldName:e.t1,newPreset:e.t2,newName:e.t3,newFeature:e.t4,oldId:e.t5,oldVersion:e.t6,error:e.t7});case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 47:case"end":return e.stop()}}),e,null,[[6,23,26,29]])}))),se.apply(this,arguments)}var ie=n(7),oe=n.n(ie),le=function(e){var t=e.value,n=e.onChange;return Object(i.jsxs)("select",{className:oe.a.smallInput,value:t,onChange:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return n(e.target.value)})),children:[Object(i.jsx)("option",{value:"n",children:"Node"}),Object(i.jsx)("option",{value:"w",children:"Way"}),Object(i.jsx)("option",{value:"r",children:"Relation"})]})},ue=function(){var e=Object(s.useContext)(F),t=e.user,n=e.logout,a=Object(s.useState)([{type:"n"}]),c=Object(r.a)(a,2),o=c[0],l=c[1],u=Object(s.useState)(0),d=Object(r.a)(u,2),j=d[0],b=d[1],O=Object(s.useState)(),f=Object(r.a)(O,2),p=f[0],x=f[1],m=Object(s.useState)(!1),g=Object(r.a)(m,2),v=g[0],y=g[1],w=Object(s.useState)(),k=Object(r.a)(w,2),S=k[0],L=k[1];function _(e,t,n){l((function(r){return r.map((function(r,a){return e===a?Object(A.a)(Object(A.a)({},r),{},Object(R.a)({},t,n)):r}))})),x(void 0)}function I(){return(I=Object(C.a)(N.a.mark((function e(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y(!0),e.prev=1,p){e.next=10;break}return e.t0=x,e.next=6,ce(o);case 6:e.t1=e.sent,(0,e.t0)(e.t1),e.next=15;break;case 10:return e.t2=L,e.next=13,K(p);case 13:e.t3=e.sent,(0,e.t2)(e.t3);case 15:e.next=21;break;case 17:e.prev=17,e.t4=e.catch(1),console.error(e.t4),alert("".concat(e.t4));case 21:y(!1);case 22:case"end":return e.stop()}}),e,null,[[1,17]])})))).apply(this,arguments)}return S?Object(i.jsxs)("div",{className:oe.a.main,children:[Object(i.jsx)("a",{href:"".concat(Object(E.getConfig)().apiUrl,"/changeset/").concat(S),target:"_blank",rel:"noopener noreferrer",children:"Done!"}),Object(i.jsx)("br",{}),Object(i.jsx)("br",{}),Object(i.jsx)("button",{type:"button",className:oe.a.btn,onClick:function(){l([{type:"n"}]),x(void 0),L(void 0),b((function(e){return e+1}))},children:"Back"})]}):Object(i.jsxs)("div",{className:oe.a.main,children:[Object(i.jsx)("h2",{children:"Restore OSM History"}),Object(i.jsxs)("p",{children:["If an OSM Feature was deleted and redrawn, you can restore the history of the original feature using this tool.",Object(i.jsx)("br",{}),Object(i.jsx)("br",{}),Object(i.jsx)("a",{href:"https://wiki.osm.org/HistoryRestorer",target:"_blank",rel:"noopener noreferrer",children:"Wiki"})," ","|"," ",Object(i.jsx)("a",{href:"https://github.com/osm-nz/osm-nz.github.io/tree/main/src/pages/HistoryRestorer",target:"_blank",rel:"noopener noreferrer",children:"Source Code"}),Object(i.jsx)("br",{}),Object(i.jsx)("br",{})]}),Object(i.jsxs)("div",{className:oe.a.list,children:[Object(i.jsxs)("div",{className:oe.a.item,children:[Object(i.jsx)("strong",{children:"Deleted Feature"}),Object(i.jsx)("strong",{children:"New Feature"})]},0),o.map((function(e,t){var n=null===p||void 0===p?void 0:p[t];return Object(i.jsxs)("div",{className:oe.a.item,children:[Object(i.jsxs)("div",{children:[Object(i.jsx)(le,{value:e.type,onChange:function(e){return _(t,"type",e)}}),Object(i.jsx)("input",{className:oe.a.smallInput,type:"tel",value:e.fromId||"",onChange:function(e){return _(t,"fromId",+e.target.value)}}),n&&Object(i.jsxs)("small",{children:[Object(i.jsx)("br",{}),Object(i.jsx)("strong",{children:n.oldPreset})," \xa0 ",n.oldName,n.error&&Object(i.jsxs)("span",{className:oe.a.error,children:[Object(i.jsx)("br",{}),n.error]})]})]}),Object(i.jsx)("div",{children:"\u27a1\ufe0f"}),Object(i.jsxs)("div",{children:[Object(i.jsx)(le,{value:e.type,onChange:function(e){return _(t,"type",e)}}),Object(i.jsx)("input",{className:oe.a.smallInput,type:"tel",value:e.toId||"",onChange:function(e){return _(t,"toId",+e.target.value)}}),n&&Object(i.jsxs)("small",{children:[Object(i.jsx)("br",{}),Object(i.jsx)("strong",{children:n.newPreset})," \xa0 ",n.newName]})]}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{type:"button",disabled:1===o.length,className:"".concat(oe.a.btn," ").concat(oe.a.smallInput),onClick:function(){b((function(e){return e+1})),x(void 0),l((function(e){var n=Object(h.a)(e);return n.splice(t,1),n}))},children:"\ud83d\uddd1\ufe0f"})})]},j+t)}))]}),Object(i.jsx)("br",{}),Object(i.jsx)("button",{type:"button",className:oe.a.btn,onClick:function(){l((function(e){return[].concat(Object(h.a)(e),[{type:"n"}])})),x(void 0)},children:"Add Another feature"}),Object(i.jsx)("br",{}),Object(i.jsx)("br",{}),v&&Object(i.jsx)(i.Fragment,{children:"Loading..."}),Object(i.jsx)("button",{type:"submit",disabled:v,onClick:function(){return I.apply(this,arguments)},className:"".concat(oe.a.btn," ").concat(p?oe.a.saveBtn:""),children:p?"Save":"Next"}),Object(i.jsx)("br",{}),Object(i.jsx)("br",{}),"Logged in as ",Object(i.jsx)("code",{children:t.display_name}),"."," ",Object(i.jsx)("a",{onClick:n,children:"Logout"})]})},de=function(){return Object(i.jsx)(z,{children:Object(i.jsx)(ue,{})})},je=(n(50),function(){return window.location.hash.substr(1)}),be=function(){var e=Object(s.useState)(je()),t=Object(r.a)(e,2),n=t[0],a=t[1];return Object(s.useEffect)((function(){var e=function(){return a(je())};return window.addEventListener("popstate",e),function(){return window.removeEventListener("popstate",e)}}),[]),"/whatsup"===n?Object(i.jsx)(Y,{}):"/upload"===n?Object(i.jsx)(V,{}):"/map"===n?Object(i.jsx)(_,{}):"/restore-history"===n?Object(i.jsx)(de,{}):Object(i.jsx)(u,{})};c.a.render(Object(i.jsx)(s.StrictMode,{children:Object(i.jsx)(be,{})}),document.querySelector("main"))},7:function(e,t,n){e.exports={main:"HistoryRestorer_main__1QTH3",list:"HistoryRestorer_list__3ZJto",item:"HistoryRestorer_item__1nsLG",error:"HistoryRestorer_error__3Ekvo",btn:"HistoryRestorer_btn__cqwMH",smallInput:"HistoryRestorer_smallInput__3jRFX",saveBtn:"HistoryRestorer_saveBtn__34zlD"}}},[[51,1,2]]]);
//# sourceMappingURL=main.a5756dd1.chunk.js.map