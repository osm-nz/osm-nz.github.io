{"version":3,"sources":["pages/home/Home.tsx","helpers/general.ts","pages/map/Map.tsx","pages/whatsup/index.tsx","index.tsx"],"names":["META","PERFECT","EXISTS_BUT_WRONG_DATA","EXISTS_BUT_NO_LINZ_REF","MULTIPLE_EXIST_BUT_NO_LINZ_REF","MULTIPLE_EXIST","EXISTS_BUT_LOCATION_WRONG","TOTALLY_MISSING","NEEDS_DELETE","NEEDS_DELETE_NON_TRIVIAL","CORRUPT","LINZ_REF_CHANGED","COULD_BE_STACKED","CDN_BASE_URL","Home","useState","error","setError","data","setData","useEffect","fetch","then","r","json","catch","d","Date","date","hours","Math","round","style","margin","href","className","fontWeight","Object","entries","count","map","status","n","category","howToAction","rawFile","toLocaleString","total","toFixed","uniqBy","prop","arr","Map","item","values","baseUrl","fromRapiD","window","opener","getColor","getPolygon","x","isLocked","color","totalCount","fillOpacity","opacity","stroke","weight","beforeHoveredColor","toggleFeatureHighlight","e","on","target","options","setStyle","bboxToPoly","minLng","minLat","maxLng","maxLat","headers","Expires","Pragma","showPreview","setShowPreview","layer","setLayer","Promise","all","random","layers","results","t","name","split","isPreview","groupCategories","filter","getLockedMsg","id","console","log","height","textAlign","type","checked","onChange","display","flexWrap","l","join","onClick","MapContainer","width","center","zoom","scrollWheelZoom","LayersControl","position","BaseLayer","TileLayer","attribution","url","startsWith","Polygon","pathOptions","positions","extent","eventHandlers","click","locked","user","minutesAgo","suffix","msg","confirm","postMessage","close","returnToRapiD","mouseover","ev","mouseout","Tooltip","direction","sticky","snippet","_","i","grades","background","WrappedWhatsup","getCurrentRoute","location","hash","substr","App","path","setPath","onNavigate","addEventListener","removeEventListener","ReactDOM","render","document","querySelector"],"mappings":"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","file":"static/js/main.83e5e306.chunk.js","sourcesContent":["import { useEffect, useState } from 'react';\n\nconst META = {\n  PERFECT: [1, 'Data is already perfect', 'No action required'],\n  EXISTS_BUT_WRONG_DATA: [\n    2,\n    'Address exists but the data is wrong',\n    'Select a suburb in the tool, edits will be shown',\n    'data-wrong.txt',\n  ],\n  EXISTS_BUT_NO_LINZ_REF: [\n    3,\n    'Address exists but no linz ref',\n    'Select a suburb in the tool, edits will be shown',\n    'needs-linz-ref.txt',\n  ],\n  MULTIPLE_EXIST_BUT_NO_LINZ_REF: [\n    4,\n    'Multiple addresses exists, none have linz ref',\n    'manual action required',\n    'needs-linz-ref-but-multiple.txt',\n  ],\n  MULTIPLE_EXIST: [\n    5,\n    'Multiple addresses exists with same linz ref',\n    'manual action required',\n    'duplicate-linz-ref.txt',\n  ],\n  EXISTS_BUT_LOCATION_WRONG: [\n    6,\n    'Addresses exist but location is very wrong',\n    'Select the suburb called \"ZZ Special Location Wrong\".',\n    'location-wrong.txt',\n  ],\n  TOTALLY_MISSING: [\n    7,\n    'Addresses totally missing from OSM',\n    'Select a suburb in the tool',\n  ],\n  NEEDS_DELETE: [\n    8,\n    'Addresses in OSM that have been deleted by LINZ',\n    'Select a suburb in the tool. Addresses to be deleted will be shown in red.',\n    'needs-delete.txt',\n  ],\n  NEEDS_DELETE_NON_TRIVIAL: [\n    9,\n    'Addresses in OSM that have been deleted by LINZ, but are on a OSM building or business',\n    'manual action required',\n    'needs-delete-non-trivial.txt',\n  ],\n  CORRUPT: [\n    10,\n    'There are multiple LINZ refs on the same OSM node',\n    'manual action required',\n    'corrupt.txt',\n  ],\n  LINZ_REF_CHANGED: [\n    11,\n    'LINZ has changed their ID for an address, but not the data',\n    \"Select the suburb called 'ZZ Special Linz Ref Changed'\",\n    'linz-ref-changed.txt',\n  ],\n  COULD_BE_STACKED: [\n    13,\n    'Addresses in OSM that are perfect, but the flats/units could be stacked if this is desired.',\n    'N/A. Just for statistics',\n    'could-be-stacked.txt',\n  ],\n};\n\nconst CDN_BASE_URL = 'https://linz-addr-cdn.kyle.kiwi';\n\ntype Data = {\n  date: number;\n  count: Record<keyof typeof META, number>;\n  total: number;\n};\n\nexport const Home: React.VFC = () => {\n  const [error, setError] = useState<Error>();\n  const [data, setData] = useState<Data>();\n\n  useEffect(() => {\n    fetch(`${CDN_BASE_URL}/stats.json`)\n      .then((r) => r.json())\n      .then(setData)\n      .catch(setError);\n  }, []);\n\n  if (error) return <>Error.</>;\n  if (!data) return <>Loading...</>;\n\n  const d = new Date(data.date);\n  const hours = Math.round((+new Date() - +d) / 1000 / 60 / 60);\n\n  return (\n    <div style={{ margin: 15 }}>\n      <a href=\"./RapiD/\" className=\"start\">\n        âœ¨ Click to start mapping!\n      </a>\n      <table className=\"busy\">\n        <thead>\n          <tr style={{ fontWeight: 600 }}>\n            <td>Code</td>\n            <td>Data Category</td>\n            <td>No. of addresses</td>\n            <td>Percentage of total</td>\n            <td>How to action</td>\n            <td>Raw data</td>\n          </tr>\n        </thead>\n        <tbody>\n          {Object.entries(data.count).map(([status, count]) => {\n            const [n, category, howToAction, rawFile] =\n              META[status as keyof typeof META];\n            return (\n              <tr>\n                <td>{n}</td>\n                <td>{category}</td>\n                <td>{count.toLocaleString('en-nz')}</td>\n                <td>{((count / data.total) * 100).toFixed(2)}%</td>\n                <td>{howToAction}</td>\n                {rawFile && (\n                  <td>\n                    <a href={`${CDN_BASE_URL}/${rawFile}`}>download</a>\n                  </td>\n                )}\n              </tr>\n            );\n          })}\n        </tbody>\n      </table>\n      <p style={{ margin: 12 }}>\n        Statistics last updated on {d.toLocaleString('en-nz')} ({hours} hours\n        ago)\n      </p>\n      <footer>\n        For more infomation, see:\n        <ul>\n          <li>\n            <a href=\"https://wiki.openstreetmap.org/wiki/Import/New_Zealand_Street_Addresses_(2021)\">\n              the wiki page\n            </a>\n          </li>\n          <li>\n            <a href=\"https://github.com/osm-nz/linz-address-import\">\n              the repository containing the source code\n            </a>\n          </li>\n          <li>\n            <a href=\"https://osmcha.org/?aoi=5a4d6cbe-37f9-4b5b-a6d6-0c69dd488a07\">\n              All changesets uploaded so far\n            </a>\n          </li>\n          <li>\n            <a href=\"https://github.com/osm-nz/linz-address-import/issues/1\">\n              The import progress\n            </a>\n          </li>\n          <li>\n            <a href=\"#/map\">A map of all the sectors requiring attention</a>\n          </li>\n        </ul>\n      </footer>\n    </div>\n  );\n};\n","export const uniqBy = <T>(prop: keyof T, arr: T[]): T[] => [\n  ...new Map(arr.map((item) => [item[prop], item])).values(),\n];\n","import { useEffect, useState } from 'react';\nimport {\n  MapContainer,\n  TileLayer,\n  LayersControl,\n  Polygon,\n  Tooltip,\n} from 'react-leaflet';\nimport { LeafletMouseEvent } from 'leaflet';\nimport { uniqBy } from '../../helpers';\n\nimport 'leaflet/dist/leaflet.css';\n\nconst baseUrl = 'https://linz-addr-cdn.kyle.kiwi';\n\n// if rapid has opened this page in a popup\nconst fromRapiD = !!window.opener;\n\ntype Locked = undefined | [user: string, minutes: 'done' | number];\ntype BBox = [\n  [minLng: number, minLat: number],\n  [maxLng: number, maxLat: number],\n];\ntype Layer = {\n  extent: BBox;\n  groupCategories: string[];\n  id: string;\n  name: string;\n  osmChangeAvailable: boolean;\n  snippet: string;\n  source: '';\n  title: string;\n  totalCount: number;\n  url: string;\n};\n\ntype Data = [\n  layers: {\n    results: Layer[];\n  },\n  locked: {\n    [datasetId: string]: Locked;\n  },\n];\n\nfunction returnToRapiD(id: string, locked: Locked) {\n  if (locked) {\n    const [user, minutesAgo] = locked;\n    const suffix =\n      'Check back in a day.\\n\\nIf you continue, you might override or duplicate their work!';\n    const msg =\n      minutesAgo === 'done'\n        ? `This dataset may already have been uploaded by someone else! ${suffix}`\n        : `Someone else (${user}) started editing this dataset ${minutesAgo} minutes ago. ${suffix}`;\n\n    // eslint-disable-next-line no-restricted-globals, no-alert\n    if (!confirm(msg)) return;\n  }\n\n  window.opener.postMessage(`ADD_SECTOR=${id}`);\n  window.close();\n}\n\n// Return a deeper red for changesets with more changes\nfunction getColor(d: number) {\n  /* eslint-disable no-nested-ternary */\n  return d > 1000\n    ? '#3a0000'\n    : d > 500\n    ? '#67001f'\n    : d > 200\n    ? '#980043'\n    : d > 100\n    ? '#ce1256'\n    : d > 60\n    ? '#e7298a'\n    : d > 40\n    ? '#df65b0'\n    : d > 20\n    ? '#c994c7'\n    : '#d4b9da';\n  /* eslint-enable no-nested-ternary */\n}\n\nfunction getPolygon(x: Layer, isLocked: Locked) {\n  const color = isLocked ? '#aaaaaa' : getColor(x.totalCount);\n  const fillOpacity = 0.3;\n  const stroke = true;\n  const opacity = 1;\n  const weight = 2;\n\n  return {\n    color,\n    fillOpacity,\n    opacity,\n    stroke,\n    weight,\n  };\n}\n\nlet beforeHoveredColor = 'orange'; // store colour of the hovered polygon\nfunction toggleFeatureHighlight(e: LeafletMouseEvent, on: boolean) {\n  // highlight polygon on mouse hover\n  if (on) {\n    beforeHoveredColor = e.target.options.color;\n    e.target.setStyle({ color: 'yellow' });\n  } else {\n    e.target.setStyle({ color: beforeHoveredColor });\n  }\n}\n\nfunction bboxToPoly([[minLng, minLat], [maxLng, maxLat]]: BBox): [\n  lng: number,\n  lat: number,\n][] {\n  return [\n    [maxLat, minLng], // NW\n    [maxLat, maxLng], // NE\n    [minLat, maxLng], // SE\n    [minLat, minLng], // SW\n  ];\n}\nconst headers = {\n  Expires: 'Tue, 01 Jan 1980 1:00:00 GMT',\n  'Cache-Control': 'no-cache, no-store, max-age=0',\n  Pragma: 'no-cache',\n};\n\nexport const Map: React.VFC = () => {\n  const [showPreview, setShowPreview] = useState(false);\n  const [layer, setLayer] = useState<string>();\n  const [error, setError] = useState();\n  const [data, setData] = useState<Data>();\n\n  useEffect(() => {\n    Promise.all([\n      fetch(`${baseUrl}/index.json?nocache=${Math.random()}`, { headers }).then(\n        (r) => r.json(),\n      ),\n      fetch(`${baseUrl}/__locked?nocache=${Math.random()}`, { headers })\n        .then((r) => r.json())\n        .catch(() => ({})),\n    ])\n      .then(setData)\n      .catch(setError);\n  }, []);\n\n  if (error) return <>Error</>;\n  if (!data) return <>Loading...</>;\n\n  const layers = uniqBy(\n    'name',\n    data[0].results\n      .map((t) => ({\n        name: t.name.split(' - ')[0],\n        isPreview: t.groupCategories[0] === '/Categories/Preview',\n      }))\n      .filter((x) => showPreview || !x.isPreview),\n  );\n\n  const getLockedMsg = (x: Layer) =>\n    data[1][x.id]\n      ? `Someone else ${\n          data[1][x.id]![1] === 'done'\n            ? 'may have already uploaded'\n            : 'is working on'\n        } this dataset! Check back in one day.`\n      : '';\n\n  console.log({ data });\n\n  return (\n    <>\n      <div style={{ height: 200 }}>\n        {fromRapiD && (\n          <div style={{ textAlign: 'center' }}>\n            <h3 style={{ margin: 0 }}>Please select a suburb to edit</h3>\n            You can close this page and use the list if you prefer\n          </div>\n        )}\n        <input\n          type=\"checkbox\"\n          checked={showPreview}\n          onChange={(e) => setShowPreview(e.target.checked)}\n        />\n        Show Preview Layers\n        <br />\n        <br />\n        <div style={{ display: 'flex', flexWrap: 'wrap' }}>\n          {layers.map((l) => (\n            <button\n              key={l.name}\n              type=\"button\"\n              className={[\n                layer === l.name ? 'active-layer' : 'inactive-layer',\n                l.isPreview ? 'preview-layer' : '',\n              ].join(' ')}\n              onClick={() => setLayer(l.name)}\n            >\n              {l.name}\n            </button>\n          ))}\n        </div>\n      </div>\n      <MapContainer\n        style={{ width: '100vw', height: 'calc(100vh - 200px)' }}\n        center={[-40.98, 166.9]}\n        zoom={6}\n        scrollWheelZoom\n      >\n        <LayersControl position=\"topright\">\n          <LayersControl.BaseLayer checked name=\"OpenStreetMap\">\n            <TileLayer\n              attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n              url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n            />\n          </LayersControl.BaseLayer>\n          <LayersControl.BaseLayer name=\"LINZ Aerial Imagery\">\n            <TileLayer\n              attribution='<a href=\"https://www.linz.govt.nz/data/licensing-and-using-data/attributing-elevation-or-aerial-imagery-data\">Sourced from LINZ CC-BY 4.0</a>'\n              url=\"https://basemaps.linz.govt.nz/v1/tiles/aerial/EPSG:3857/{z}/{x}/{y}.jpg?api=d01egend5f8dv4zcbfj6z2t7rs3\"\n            />\n          </LayersControl.BaseLayer>\n          <LayersControl.BaseLayer name=\"LINZ Topo50\">\n            <TileLayer\n              attribution='<a href=\"https://www.linz.govt.nz/data/licensing-and-using-data/attributing-elevation-or-aerial-imagery-data\">Sourced from LINZ CC-BY 4.0</a>'\n              url=\"https://map.cazzaserver.com/linz_topo/{z}/{x}/{y}.png\"\n            />\n          </LayersControl.BaseLayer>\n        </LayersControl>\n\n        {layer &&\n          data[0].results\n            .filter((x) => x.name.startsWith(layer))\n            .map((x) => (\n              <Polygon\n                pathOptions={getPolygon(x, data[1][x.id])}\n                positions={bboxToPoly(x.extent)}\n                eventHandlers={{\n                  click: () => {\n                    if (fromRapiD) returnToRapiD(x.id, data[1][x.id]);\n                  },\n                  mouseover: (ev) => toggleFeatureHighlight(ev, true),\n                  mouseout: (ev) => toggleFeatureHighlight(ev, false),\n                }}\n              >\n                <Tooltip direction=\"bottom\" sticky>\n                  <strong>{x.name}</strong>\n                  <br />\n                  {x.snippet}\n                  <br />\n                  {getLockedMsg(x)}\n                </Tooltip>\n              </Polygon>\n            ))}\n        <div\n          className=\"legend leaflet-bottom leaflet-left\"\n          style={{ margin: 20 }}\n        >\n          <strong># of changes</strong>\n          <br />\n          {[0, 20, 40, 60, 100, 200, 500, 1000].map((_, i, grades) => (\n            <>\n              <i style={{ background: getColor(grades[i] + 1) }} />\n              {grades[i]}\n              {grades[i + 1] ? (\n                <>\n                  &ndash;{grades[i + 1]}\n                  <br />\n                </>\n              ) : (\n                '+'\n              )}\n            </>\n          ))}\n        </div>\n      </MapContainer>\n    </>\n  );\n};\n","export const WrappedWhatsup: React.VFC = () => <>Hello!</>;\n","import ReactDOM from 'react-dom';\nimport { StrictMode, useEffect, useState } from 'react';\nimport { Home, Map, WrappedWhatsup } from './pages';\n\nimport './index.css';\n\nconst getCurrentRoute = () => window.location.hash.substr(1);\n\nconst App: React.VFC = () => {\n  const [path, setPath] = useState<string>(getCurrentRoute());\n\n  useEffect(() => {\n    const onNavigate = () => setPath(getCurrentRoute());\n    window.addEventListener('popstate', onNavigate);\n    return () => window.removeEventListener('popstate', onNavigate);\n  }, []);\n\n  if (path === '/whatsup') return <WrappedWhatsup />;\n  if (path === '/map') return <Map />;\n\n  // all other routes: show home page\n  return <Home />;\n};\n\nReactDOM.render(\n  <StrictMode>\n    <App />\n  </StrictMode>,\n  document.querySelector('main'),\n);\n"],"sourceRoot":""}