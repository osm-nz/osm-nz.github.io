{"version":3,"sources":["pages/home/Home.tsx","helpers/general.ts","pages/map/Layers.tsx","pages/map/Map.tsx","wrappers/AuthGateway.tsx","pages/upload/MapPreview.tsx","pages/upload/TagChanges.tsx","pages/upload/PlusMinus.tsx","pages/upload/Upload.tsx","pages/whatsup/index.tsx","index.tsx"],"names":["META","PERFECT","EXISTS_BUT_WRONG_DATA","EXISTS_BUT_NO_LINZ_REF","MULTIPLE_EXIST_BUT_NO_LINZ_REF","MULTIPLE_EXIST","EXISTS_BUT_LOCATION_WRONG","TOTALLY_MISSING","NEEDS_DELETE","NEEDS_DELETE_NON_TRIVIAL","CORRUPT","LINZ_REF_CHANGED","COULD_BE_STACKED","NEEDS_DELETE_ON_BUILDING","CDN_BASE_URL","Home","useState","error","setError","data","setData","useEffect","fetch","then","r","json","catch","d","Date","date","hours","Math","round","style","margin","href","className","fontWeight","Object","entries","count","map","status","n","category","howToAction","rawFile","toLocaleString","total","toFixed","uniqBy","prop","arr","Map","item","values","Layers","LayersControl","position","BaseLayer","checked","name","TileLayer","attribution","url","baseUrl","fromRapiD","window","opener","getColor","getPolygon","x","isLocked","color","totalCount","fillOpacity","opacity","stroke","weight","beforeHoveredColor","toggleFeatureHighlight","e","on","target","options","setStyle","bboxToPoly","minLng","minLat","maxLng","maxLat","headers","Expires","Pragma","showPreview","setShowPreview","layer","setLayer","Promise","all","random","layers","results","t","split","isPreview","groupCategories","filter","getLockedMsg","id","height","textAlign","type","onChange","display","flexWrap","l","join","onClick","MapContainer","width","center","zoom","scrollWheelZoom","startsWith","Polygon","pathOptions","positions","extent","eventHandlers","click","locked","user","minutesAgo","suffix","msg","confirm","postMessage","close","returnToRapiD","mouseover","ev","mouseout","Tooltip","direction","sticky","snippet","_","i","grades","background","AuthContext","createContext","AuthGateway","children","loading","setLoading","isLoggedIn","loggedIn","setLoggedIn","setUser","getUser","onClickLogin","useCallback","a","login","clientId","location","hostname","mode","redirectUrl","scopes","undefined","onLogout","logout","ctx","useMemo","Provider","value","MapPreview","diff","polygonGroup","useRef","bbox","osmChange","Infinity","flat","forEach","node","lat","lon","getCsBbox","whenCreated","fitBounds","current","getBounds","FeatureGroup","ref","out","added","removed","featureDeleted","changed","create","f","tags","key","delete","toFetch","modify","reduce","ac","getFeatures","way","relation","features","oldVersions","oldTags","newTags","allKeys","keys","renderSimpleSection","list","prefix","vals","length","val","TagChanges","changes","setChanges","calcTagChanges","console","log","PlusMinus","padding","DEFAULT_TAGS","created_by","locale","navigator","language","source","comment","fileToString","fileObj","resolve","FileReader","readAsText","onloadend","result","parseCsTags","str","fromEntries","k","v","trim","tagsToStr","UploadInner","useContext","setResult","csTags","setCsTags","setDiff","parsedTags","files","xml","parseOsmChangeXml","uploadChangeset","display_name","accept","onFileUpload","document","querySelector","onBlur","newParsed","disabled","fontSize","Upload","WrappedWhatsup","getCurrentRoute","hash","substr","App","path","setPath","onNavigate","addEventListener","removeEventListener","ReactDOM","render"],"mappings":"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","file":"static/js/main.034a4b5b.chunk.js","sourcesContent":["import { useEffect, useState } from 'react';\n\nconst META = {\n  PERFECT: [1, 'Data is already perfect', 'No action required'],\n  EXISTS_BUT_WRONG_DATA: [\n    2,\n    'Address exists but the data is wrong',\n    'Select a suburb in the tool',\n    'data-wrong.txt',\n  ],\n  EXISTS_BUT_NO_LINZ_REF: [\n    3,\n    'Address exists but no linz ref',\n    'Select a suburb in the tool',\n    'needs-linz-ref.txt',\n  ],\n  MULTIPLE_EXIST_BUT_NO_LINZ_REF: [\n    4,\n    'Multiple addresses exists, none have linz ref',\n    'manual action required',\n    'needs-linz-ref-but-multiple.txt',\n  ],\n  MULTIPLE_EXIST: [\n    5,\n    'Multiple addresses exists with same linz ref',\n    'manual action required',\n    'duplicate-linz-ref.txt',\n  ],\n  EXISTS_BUT_LOCATION_WRONG: [\n    6,\n    'Addresses exist but location is very wrong',\n    'Select the suburb called \"ZZ Special Location Wrong\".',\n    'location-wrong.txt',\n  ],\n  TOTALLY_MISSING: [\n    7,\n    'Addresses totally missing from OSM',\n    'Select a suburb in the tool',\n  ],\n  NEEDS_DELETE: [\n    8,\n    'Addresses in OSM that have been deleted by LINZ',\n    'Select a suburb in the tool',\n    'needs-delete.txt',\n  ],\n  NEEDS_DELETE_NON_TRIVIAL: [\n    9,\n    'Addresses in OSM that have been deleted by LINZ, but are on a OSM business/POI',\n    'manual action required',\n    'needs-delete-non-trivial.txt',\n  ],\n  CORRUPT: [\n    10,\n    'There are multiple LINZ refs on the same OSM node',\n    'manual action required',\n    'corrupt.txt',\n  ],\n  LINZ_REF_CHANGED: [\n    11,\n    'LINZ has changed their ID for an address, but not the data',\n    \"Select the suburb called 'ZZ Special Linz Ref Changed'\",\n    'linz-ref-changed.txt',\n  ],\n  COULD_BE_STACKED: [\n    13,\n    'Addresses in OSM that are perfect, but the flats/units could be stacked if this is desired.',\n    'N/A. Just for statistics',\n    'could-be-stacked.txt',\n  ],\n  NEEDS_DELETE_ON_BUILDING: [\n    14,\n    'Addresses in OSM that have been deleted by LINZ, but are on a OSM building',\n    'Select a suburb in the tool',\n    'needs-delete-on-building.txt',\n  ],\n};\n\nconst CDN_BASE_URL = 'https://linz-addr-cdn.kyle.kiwi';\n\ntype Data = {\n  date: number;\n  count: Record<keyof typeof META, number>;\n  total: number;\n};\n\nexport const Home: React.VFC = () => {\n  const [error, setError] = useState<Error>();\n  const [data, setData] = useState<Data>();\n\n  useEffect(() => {\n    fetch(`${CDN_BASE_URL}/stats.json`)\n      .then((r) => r.json())\n      .then(setData)\n      .catch(setError);\n  }, []);\n\n  if (error) return <>Error.</>;\n  if (!data) return <>Loading...</>;\n\n  const d = new Date(data.date);\n  const hours = Math.round((+new Date() - +d) / 1000 / 60 / 60);\n\n  return (\n    <div style={{ margin: 15 }}>\n      <a href=\"./RapiD/\" className=\"start\">\n        ✨ Click to start mapping!\n      </a>\n      <table className=\"busy\">\n        <thead>\n          <tr style={{ fontWeight: 600 }}>\n            <td>Code</td>\n            <td>Data Category</td>\n            <td>No. of addresses</td>\n            <td>Percentage of total</td>\n            <td>How to action</td>\n            <td>Raw data</td>\n          </tr>\n        </thead>\n        <tbody>\n          {Object.entries(data.count).map(([status, count]) => {\n            const [n, category, howToAction, rawFile] =\n              META[status as keyof typeof META];\n            return (\n              <tr>\n                <td>{n}</td>\n                <td>{category}</td>\n                <td>{count.toLocaleString('en-nz')}</td>\n                <td>{((count / data.total) * 100).toFixed(2)}%</td>\n                <td>{howToAction}</td>\n                {rawFile && (\n                  <td>\n                    <a href={`${CDN_BASE_URL}/${rawFile}`}>download</a>\n                  </td>\n                )}\n              </tr>\n            );\n          })}\n        </tbody>\n      </table>\n      <p style={{ margin: 12 }}>\n        Statistics last updated on {d.toLocaleString('en-nz')} ({hours} hours\n        ago)\n      </p>\n      <footer>\n        For more infomation, see:\n        <ul>\n          <li>\n            <a href=\"https://wiki.openstreetmap.org/wiki/Import/New_Zealand_Street_Addresses_(2021)\">\n              the wiki page\n            </a>\n          </li>\n          <li>\n            <a href=\"https://github.com/osm-nz/linz-address-import\">\n              the repository containing the source code\n            </a>\n          </li>\n          <li>\n            <a href=\"https://osmcha.org/?aoi=5a4d6cbe-37f9-4b5b-a6d6-0c69dd488a07\">\n              All changesets uploaded so far\n            </a>\n          </li>\n          <li>\n            <a href=\"https://github.com/osm-nz/linz-address-import/issues/1\">\n              The import progress\n            </a>\n          </li>\n          <li>\n            <a href=\"#/map\">A map of all the sectors requiring attention</a>\n          </li>\n        </ul>\n      </footer>\n    </div>\n  );\n};\n","export const uniqBy = <T>(prop: keyof T, arr: T[]): T[] => [\n  ...new Map(arr.map((item) => [item[prop], item])).values(),\n];\n","import { TileLayer, LayersControl } from 'react-leaflet';\n\nexport const Layers: React.VFC = () => (\n  <LayersControl position=\"topright\">\n    <LayersControl.BaseLayer checked name=\"OpenStreetMap\">\n      <TileLayer\n        attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n      />\n    </LayersControl.BaseLayer>\n    <LayersControl.BaseLayer name=\"LINZ Aerial Imagery\">\n      <TileLayer\n        attribution='<a href=\"https://www.linz.govt.nz/data/licensing-and-using-data/attributing-elevation-or-aerial-imagery-data\">Sourced from LINZ CC-BY 4.0</a>'\n        url=\"https://basemaps.linz.govt.nz/v1/tiles/aerial/EPSG:3857/{z}/{x}/{y}.jpg?api=d01egend5f8dv4zcbfj6z2t7rs3\"\n      />\n    </LayersControl.BaseLayer>\n    <LayersControl.BaseLayer name=\"LINZ Topo50\">\n      <TileLayer\n        attribution='<a href=\"https://www.linz.govt.nz/data/licensing-and-using-data/attributing-elevation-or-aerial-imagery-data\">Sourced from LINZ CC-BY 4.0</a>'\n        url=\"https://map.cazzaserver.com/linz_topo/{z}/{x}/{y}.png\"\n      />\n    </LayersControl.BaseLayer>\n  </LayersControl>\n);\n","import { useEffect, useState } from 'react';\nimport { MapContainer, Polygon, Tooltip } from 'react-leaflet';\nimport { LeafletMouseEvent } from 'leaflet';\nimport { uniqBy } from '../../helpers';\nimport { Layers } from './Layers';\n\nimport 'leaflet/dist/leaflet.css';\n\nconst baseUrl = 'https://linz-addr-cdn.kyle.kiwi';\n\n// if rapid has opened this page in a popup\nconst fromRapiD = !!window.opener;\n\ntype Locked = undefined | [user: string, minutes: 'done' | number];\ntype BBox = [\n  [minLng: number, minLat: number],\n  [maxLng: number, maxLat: number],\n];\ntype Layer = {\n  extent: BBox;\n  groupCategories: string[];\n  id: string;\n  name: string;\n  osmChangeAvailable: boolean;\n  snippet: string;\n  source: '';\n  title: string;\n  totalCount: number;\n  url: string;\n};\n\ntype Data = [\n  layers: {\n    results: Layer[];\n  },\n  locked: {\n    [datasetId: string]: Locked;\n  },\n];\n\nfunction returnToRapiD(id: string, locked: Locked) {\n  if (locked) {\n    const [user, minutesAgo] = locked;\n    const suffix =\n      'Check back in a day.\\n\\nIf you continue, you might override or duplicate their work!';\n    const msg =\n      minutesAgo === 'done'\n        ? `This dataset may already have been uploaded by someone else! ${suffix}`\n        : `Someone else (${user}) started editing this dataset ${minutesAgo} minutes ago. ${suffix}`;\n\n    // eslint-disable-next-line no-restricted-globals, no-alert\n    if (!confirm(msg)) return;\n  }\n\n  window.opener.postMessage(`ADD_SECTOR=${id}`);\n  window.close();\n}\n\n// Return a deeper red for changesets with more changes\nfunction getColor(d: number) {\n  /* eslint-disable no-nested-ternary */\n  return d > 1000\n    ? '#3a0000'\n    : d > 500\n    ? '#67001f'\n    : d > 200\n    ? '#980043'\n    : d > 100\n    ? '#ce1256'\n    : d > 60\n    ? '#e7298a'\n    : d > 40\n    ? '#df65b0'\n    : d > 20\n    ? '#c994c7'\n    : '#d4b9da';\n  /* eslint-enable no-nested-ternary */\n}\n\nfunction getPolygon(x: Layer, isLocked: Locked) {\n  const color = isLocked ? '#aaaaaa' : getColor(x.totalCount);\n  const fillOpacity = 0.3;\n  const stroke = true;\n  const opacity = 1;\n  const weight = 2;\n\n  return {\n    color,\n    fillOpacity,\n    opacity,\n    stroke,\n    weight,\n  };\n}\n\nlet beforeHoveredColor = 'orange'; // store colour of the hovered polygon\nfunction toggleFeatureHighlight(e: LeafletMouseEvent, on: boolean) {\n  // highlight polygon on mouse hover\n  if (on) {\n    beforeHoveredColor = e.target.options.color;\n    e.target.setStyle({ color: 'yellow' });\n  } else {\n    e.target.setStyle({ color: beforeHoveredColor });\n  }\n}\n\nfunction bboxToPoly([[minLng, minLat], [maxLng, maxLat]]: BBox): [\n  lng: number,\n  lat: number,\n][] {\n  return [\n    [maxLat, minLng], // NW\n    [maxLat, maxLng], // NE\n    [minLat, maxLng], // SE\n    [minLat, minLng], // SW\n  ];\n}\nconst headers = {\n  Expires: 'Tue, 01 Jan 1980 1:00:00 GMT',\n  'Cache-Control': 'no-cache, no-store, max-age=0',\n  Pragma: 'no-cache',\n};\n\nexport const Map: React.VFC = () => {\n  const [showPreview, setShowPreview] = useState(false);\n  const [layer, setLayer] = useState<string>();\n  const [error, setError] = useState();\n  const [data, setData] = useState<Data>();\n\n  useEffect(() => {\n    Promise.all([\n      fetch(`${baseUrl}/index.json?nocache=${Math.random()}`, { headers }).then(\n        (r) => r.json(),\n      ),\n      fetch(`${baseUrl}/__locked?nocache=${Math.random()}`, { headers })\n        .then((r) => r.json())\n        .catch(() => ({})),\n    ])\n      .then(setData)\n      .catch(setError);\n  }, []);\n\n  if (error) return <>Error</>;\n  if (!data) return <>Loading...</>;\n\n  const layers = uniqBy(\n    'name',\n    data[0].results\n      .map((t) => ({\n        name: t.name.split(' - ')[0],\n        isPreview: t.groupCategories[0] === '/Categories/Preview',\n      }))\n      .filter((x) => showPreview || !x.isPreview),\n  );\n\n  const getLockedMsg = (x: Layer) =>\n    data[1][x.id]\n      ? `Someone else ${\n          data[1][x.id]![1] === 'done'\n            ? 'may have already uploaded'\n            : 'is working on'\n        } this dataset! Check back in one day.`\n      : '';\n\n  return (\n    <>\n      <div style={{ height: 200 }}>\n        {fromRapiD && (\n          <div style={{ textAlign: 'center' }}>\n            <h3 style={{ margin: 0 }}>Please select a suburb to edit</h3>\n            You can close this page and use the list if you prefer\n          </div>\n        )}\n        <input\n          type=\"checkbox\"\n          checked={showPreview}\n          onChange={(e) => setShowPreview(e.target.checked)}\n        />\n        Show Preview Layers\n        <br />\n        <br />\n        <div style={{ display: 'flex', flexWrap: 'wrap' }}>\n          {layers.map((l) => (\n            <button\n              key={l.name}\n              type=\"button\"\n              className={[\n                layer === l.name ? 'active-layer' : 'inactive-layer',\n                l.isPreview ? 'preview-layer' : '',\n              ].join(' ')}\n              onClick={() => setLayer(l.name)}\n            >\n              {l.name}\n            </button>\n          ))}\n        </div>\n      </div>\n      <MapContainer\n        style={{ width: '100vw', height: 'calc(100vh - 200px)' }}\n        center={[-40.98, 166.9]}\n        zoom={6}\n        scrollWheelZoom\n      >\n        <Layers />\n\n        {layer &&\n          data[0].results\n            .filter((x) => x.name.startsWith(layer))\n            .map((x) => (\n              <Polygon\n                pathOptions={getPolygon(x, data[1][x.id])}\n                positions={bboxToPoly(x.extent)}\n                eventHandlers={{\n                  click: () => {\n                    if (fromRapiD) returnToRapiD(x.id, data[1][x.id]);\n                  },\n                  mouseover: (ev) => toggleFeatureHighlight(ev, true),\n                  mouseout: (ev) => toggleFeatureHighlight(ev, false),\n                }}\n              >\n                <Tooltip direction=\"bottom\" sticky>\n                  <strong>{x.name}</strong>\n                  <br />\n                  {x.snippet}\n                  <br />\n                  {getLockedMsg(x)}\n                </Tooltip>\n              </Polygon>\n            ))}\n        <div\n          className=\"legend leaflet-bottom leaflet-left\"\n          style={{ margin: 20 }}\n        >\n          <strong># of changes</strong>\n          <br />\n          {[0, 20, 40, 60, 100, 200, 500, 1000].map((_, i, grades) => (\n            <>\n              <i style={{ background: getColor(grades[i] + 1) }} />\n              {grades[i]}\n              {grades[i + 1] ? (\n                <>\n                  &ndash;{grades[i + 1]}\n                  <br />\n                </>\n              ) : (\n                '+'\n              )}\n            </>\n          ))}\n        </div>\n      </MapContainer>\n    </>\n  );\n};\n","import {\n  useState,\n  createContext,\n  useCallback,\n  useMemo,\n  useEffect,\n} from 'react';\nimport { getUser, isLoggedIn, login, logout, OsmOwnUser } from 'osm-api';\n\ntype IAuthContext = {\n  user: OsmOwnUser;\n  logout(): void;\n};\nexport const AuthContext = createContext({} as IAuthContext);\n\nexport const AuthGateway: React.FC = ({ children }) => {\n  const [error, setError] = useState<Error>();\n  const [loading, setLoading] = useState(false);\n  const [loggedIn, setLoggedIn] = useState(isLoggedIn());\n  const [user, setUser] = useState<OsmOwnUser>();\n\n  useEffect(() => {\n    if (loggedIn) {\n      getUser('me').then(setUser).catch(setError);\n    }\n  }, [loggedIn]);\n\n  const onClickLogin = useCallback(async () => {\n    try {\n      setLoading(true);\n      await login({\n        clientId:\n          window.location.hostname === '127.0.0.1'\n            ? 'oPbyNuXQIEh8ZI3zbjVWVmVyIaNB2guU6uLP2gQ3sfs'\n            : 'ZkRBVnOoBeMgwSajgG7E2bhgP5bR61knGYxsh9KKaHc',\n        mode: 'popup',\n        redirectUrl:\n          window.location.hostname === '127.0.0.1'\n            ? 'http://127.0.0.1:3000/land.html'\n            : 'https://osm-nz.github.io/land.html',\n        scopes: ['read_prefs', 'write_api', 'write_notes'],\n      });\n\n      setLoggedIn(true);\n      setLoading(false);\n      setError(undefined);\n    } catch (ex) {\n      setError(ex as Error);\n      setLoading(false);\n    }\n  }, []);\n\n  const onLogout = useCallback(() => {\n    logout();\n    setLoggedIn(false);\n    setUser(undefined);\n  }, []);\n\n  const ctx = useMemo(\n    () => ({ user: user!, logout: onLogout }),\n    [user, onLogout],\n  );\n\n  if (error) {\n    return (\n      <>\n        Failed to login!\n        <br />\n        {`${error}`}\n        <br />\n        <button type=\"button\" onClick={onClickLogin}>\n          Try Again\n        </button>\n      </>\n    );\n  }\n\n  if (loading) return <>Login in progress... (use the popup window)</>;\n\n  if (!loggedIn) {\n    return (\n      <>\n        You need to login to use this feature\n        <br />\n        <button type=\"button\" onClick={onClickLogin}>\n          Login\n        </button>\n      </>\n    );\n  }\n\n  if (!user) return <>Loading...</>;\n\n  return <AuthContext.Provider value={ctx}>{children}</AuthContext.Provider>;\n};\n","import { OsmChange, OsmNode } from 'osm-api';\nimport { useRef } from 'react';\nimport { FeatureGroup, MapContainer, Polygon } from 'react-leaflet';\nimport type { FeatureGroup as IFeatureGroup } from 'leaflet';\nimport { Layers } from '../map/Layers';\n\n/**\n * this doesn't work for ways or relations, so it's pretty dumb.\n * It only considers the nodes that exist in the osmChange file.\n * See https://wiki.osm.org/API_v0.6#Bounding_box_computation\n */\nfunction getCsBbox(osmChange: OsmChange) {\n  const bbox = {\n    minLat: Infinity,\n    minLng: Infinity,\n    maxLat: -Infinity,\n    maxLng: -Infinity,\n  };\n\n  Object.values(osmChange)\n    .flat()\n    .filter((x): x is OsmNode => x.type === 'node')\n    .forEach((node) => {\n      if (node.lat < bbox.minLat) bbox.minLat = node.lat;\n      if (node.lon < bbox.minLng) bbox.minLng = node.lon;\n      if (node.lat > bbox.maxLat) bbox.maxLat = node.lat;\n      if (node.lon > bbox.maxLng) bbox.maxLng = node.lon;\n    });\n\n  return bbox;\n}\n\nexport const MapPreview: React.VFC<{ diff: OsmChange }> = ({ diff }) => {\n  const polygonGroup = useRef<IFeatureGroup>(null);\n\n  const bbox = getCsBbox(diff);\n  return (\n    <MapContainer\n      style={{ width: 500, height: 500 }}\n      scrollWheelZoom\n      whenCreated={(map) => map.fitBounds(polygonGroup.current!.getBounds())}\n    >\n      <Layers />\n\n      <FeatureGroup ref={polygonGroup}>\n        <Polygon\n          positions={[\n            [bbox.maxLat, bbox.minLng], // NW\n            [bbox.maxLat, bbox.maxLng], // NE\n            [bbox.minLat, bbox.maxLng], // SE\n            [bbox.minLat, bbox.minLng], // SW\n          ]}\n        />\n      </FeatureGroup>\n    </MapContainer>\n  );\n};\n","import { useEffect, useState } from 'react';\nimport { getFeatures, OsmChange, OsmFeature, OsmFeatureType } from 'osm-api';\n\ntype SimpleRecord = {\n  [key: string]: { [value: string]: number };\n};\n\ntype Change = {\n  added: SimpleRecord;\n  removed: SimpleRecord;\n  featureDeleted: SimpleRecord;\n  changed: {\n    [key: string]: { [toFromValue: string]: number };\n  };\n};\n\nasync function calcTagChanges(diff: OsmChange): Promise<Change> {\n  const out: Change = {\n    added: {},\n    removed: {},\n    featureDeleted: {},\n    changed: {},\n  };\n\n  for (const f of diff.create) {\n    if (f.tags) {\n      for (const key in f.tags) {\n        const value = f.tags[key];\n        out.added[key] ||= {};\n        out.added[key][value] ||= 0;\n        out.added[key][value] += 1;\n      }\n    }\n  }\n\n  for (const f of diff.delete) {\n    if (f.tags) {\n      for (const key in f.tags) {\n        const value = f.tags[key];\n        out.featureDeleted[key] ||= {};\n        out.featureDeleted[key][value] ||= 0;\n        out.featureDeleted[key][value] += 1;\n      }\n    }\n  }\n\n  // the next bit requires calling the API to get the old version of each feature\n  const toFetch = diff.modify.reduce(\n    (ac, f) => ({\n      ...ac,\n      [f.type]: [...(ac[f.type] || []), f.id],\n    }),\n    {} as Record<OsmFeatureType, number[] | undefined>,\n  );\n\n  const features = [\n    ...(toFetch.node ? await getFeatures('node', toFetch.node) : []),\n    ...(toFetch.way ? await getFeatures('way', toFetch.way) : []),\n    ...(toFetch.relation\n      ? await getFeatures('relation', toFetch.relation)\n      : []),\n  ];\n\n  const oldVersions: Record<string, OsmFeature> = {};\n  for (const f of features) oldVersions[f.type + f.id] = f;\n\n  for (const f of diff.modify) {\n    const oldTags = oldVersions[f.type + f.id].tags || {};\n    const newTags = f.tags || {};\n    const allKeys = Object.keys({ ...oldTags, ...newTags });\n    for (const key of allKeys) {\n      if (newTags[key] && !oldTags[key]) {\n        // added\n        const value = newTags[key];\n        out.added[key] ||= {};\n        out.added[key][value] ||= 0;\n        out.added[key][value] += 1;\n      } else if (!newTags[key] && oldTags[key]) {\n        // removed\n        const value = oldTags[key];\n        out.removed[key] ||= {};\n        out.removed[key][value] ||= 0;\n        out.removed[key][value] += 1;\n      } else if (newTags[key] !== oldTags[key]) {\n        // value changed\n\n        const value = `${oldTags[key]} ~~> ${newTags[key]}`;\n\n        out.changed[key] ||= {};\n        out.changed[key][value] ||= 0;\n        out.changed[key][value] += 1;\n      }\n    }\n  }\n\n  return out;\n}\n\nconst renderSimpleSection = (\n  list: SimpleRecord,\n  prefix: string,\n  color: string,\n) =>\n  Object.entries(list).map(([key, vals]) => {\n    const tags = Object.entries(vals);\n    return (\n      <li key={prefix + key} style={{ color }}>\n        {prefix} <code>{key}=</code>\n        {tags.length > 1 ? (\n          <ul>\n            {tags.map(([val, count]) => (\n              <li key={val}>\n                <code>{val}</code> {count > 1 && `(${count})`}\n              </li>\n            ))}\n          </ul>\n        ) : (\n          <code>{tags[0][0]}</code>\n        )}\n      </li>\n    );\n  });\n\nexport const TagChanges: React.VFC<{ diff: OsmChange }> = ({ diff }) => {\n  const [error, setError] = useState<Error>();\n  const [changes, setChanges] = useState<Change>();\n\n  useEffect(() => {\n    calcTagChanges(diff).then(setChanges).catch(setError);\n  }, [diff]);\n\n  if (error) return <>Failed to calculate tag changes</>;\n  if (!changes) return <>Loading tag changes...</>;\n\n  console.log('c', changes);\n\n  return (\n    <ul>\n      {renderSimpleSection(changes.added, 'Added', 'green')}\n      {renderSimpleSection(changes.changed, 'Changed', 'orange')}\n      {renderSimpleSection(changes.removed, 'Removed', 'red')}\n      {renderSimpleSection(changes.featureDeleted, 'Deleted', 'maroon')}\n    </ul>\n  );\n};\n","import { OsmChange } from 'osm-api';\n\nexport const PlusMinus: React.VFC<{ diff: OsmChange }> = ({ diff }) => {\n  return (\n    <div style={{ padding: 4, color: '#fff' }}>\n      <span style={{ background: '#4caf50', padding: 4 }}>\n        +{diff.create.length}\n      </span>\n      <span style={{ background: '#ff9800', padding: 4 }}>\n        {diff.modify.length}\n      </span>\n      <span style={{ background: '#f44336', padding: 4 }}>\n        -{diff.delete.length}\n      </span>\n    </div>\n  );\n};\n","import { useContext, useState } from 'react';\nimport { OsmChange, parseOsmChangeXml, uploadChangeset } from 'osm-api';\nimport { AuthContext, AuthGateway } from '../../wrappers';\nimport { MapPreview } from './MapPreview';\nimport { TagChanges } from './TagChanges';\nimport { PlusMinus } from './PlusMinus';\n\n// ❤️‍🔥 This script can be used to upload an osmChange file directly to the API\n// In most cases you can upload it to Level0, but this bypasses the 500 feature\n// limit, and gives you an breakdown of what's changed.\n\nconst DEFAULT_TAGS = {\n  attribution: 'https://wiki.openstreetmap.org/wiki/Contributors#LINZ',\n  created_by: 'LINZ Data Import 1.1.1',\n  locale: navigator.language,\n  source: 'https://wiki.osm.org/LINZ',\n  comment: '',\n};\n\nconst fileToString = (fileObj: File): Promise<string> =>\n  new Promise((resolve) => {\n    const r = new FileReader();\n    r.readAsText(fileObj, 'UTF-8');\n    r.onloadend = () => resolve(r.result as string);\n  });\n\nfunction parseCsTags(str: string): Record<string, string> | undefined {\n  try {\n    return Object.fromEntries(\n      str\n        .split('\\n')\n        .map((x) => {\n          if (!x) return [];\n          const [k, v] = x.split('=');\n          return [k.trim(), v.trim()];\n        })\n        .filter(([k, v]) => k && v),\n    );\n  } catch {\n    return undefined;\n  }\n}\n\nconst tagsToStr = (tags: Record<string, string>): string =>\n  Object.entries(tags)\n    .map((v) => v.join('='))\n    .join('\\n');\n\nconst UploadInner: React.VFC = () => {\n  const { user, logout } = useContext(AuthContext);\n\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<Error>();\n  const [result, setResult] = useState<number>();\n\n  const [csTags, setCsTags] = useState(tagsToStr(DEFAULT_TAGS));\n  const [diff, setDiff] = useState<OsmChange>();\n\n  const parsedTags = parseCsTags(csTags);\n\n  async function onFileUpload(files: FileList | null) {\n    if (!files?.length) return setDiff(undefined); // unselected\n\n    const xml = await fileToString(files[0]);\n    const json = parseOsmChangeXml(xml);\n    return setDiff(json);\n  }\n\n  async function upload() {\n    setResult(undefined);\n    setError(undefined);\n    setLoading(true);\n\n    try {\n      setResult(await uploadChangeset(parsedTags!, diff!));\n    } catch (ex) {\n      setError(ex as Error);\n    }\n    setLoading(false);\n  }\n\n  if (loading) return <>Uploading...</>;\n\n  return (\n    <>\n      {error && <strong>{`${error}`}</strong>}\n      {result && (\n        <strong>\n          Uploaded! <a href={`https://osm.org/changeset/${result}`}>{result}</a>\n        </strong>\n      )}\n      <br />\n      <br />\n      Logged in as <code>{user.display_name}</code>.{' '}\n      <button type=\"button\" onClick={logout}>\n        Logout\n      </button>\n      <br />\n      <br />\n      <strong>Upload OSM Change file:</strong>\n      <br />\n      <input\n        type=\"file\"\n        accept=\".osc\"\n        onChange={(e) => onFileUpload(e.target.files)}\n      />\n      {diff && (\n        <button\n          type=\"button\"\n          onClick={() => {\n            (\n              document.querySelector('input[type=file]') as HTMLInputElement\n            ).value = '';\n            setDiff(undefined);\n          }}\n        >\n          Clear\n        </button>\n      )}\n      <br />\n      <br />\n      <strong>Changeset Tags:</strong>\n      <br />\n      <textarea\n        value={csTags}\n        onChange={(e) => setCsTags(e.target.value)}\n        onBlur={(e) => {\n          const newParsed = parseCsTags(e.target.value);\n          if (newParsed) setCsTags(tagsToStr(newParsed));\n        }}\n        style={{ width: 500, height: 200, color: parsedTags ? 'black' : 'red' }}\n      />\n      <br />\n      <br />\n      {diff ? (\n        <>\n          <PlusMinus diff={diff} />\n          <strong>Approximate Extent of nodes:</strong>\n          <br />\n          <MapPreview diff={diff} />\n          <br />\n          <br />\n          <strong>Tag Changes:</strong>\n          <br />\n          <TagChanges diff={diff} />\n          <br />\n          <br />\n          <button\n            type=\"button\"\n            onClick={upload}\n            disabled={!parsedTags?.comment}\n            style={{ fontSize: 32 }}\n          >\n            Upload\n          </button>\n        </>\n      ) : (\n        <>\n          Upload a <code>.osc</code> file to see the remaining options\n        </>\n      )}\n    </>\n  );\n};\n\nexport const Upload: React.VFC = () => (\n  <AuthGateway>\n    <UploadInner />\n  </AuthGateway>\n);\n","export const WrappedWhatsup: React.VFC = () => <>Hello!</>;\n","import ReactDOM from 'react-dom';\nimport { StrictMode, useEffect, useState } from 'react';\nimport { Home, Map, Upload, WrappedWhatsup } from './pages';\n\nimport './index.css';\n\nconst getCurrentRoute = () => window.location.hash.substr(1);\n\nconst App: React.VFC = () => {\n  const [path, setPath] = useState<string>(getCurrentRoute());\n\n  useEffect(() => {\n    const onNavigate = () => setPath(getCurrentRoute());\n    window.addEventListener('popstate', onNavigate);\n    return () => window.removeEventListener('popstate', onNavigate);\n  }, []);\n\n  if (path === '/whatsup') return <WrappedWhatsup />;\n  if (path === '/upload') return <Upload />;\n  if (path === '/map') return <Map />;\n\n  // all other routes: show home page\n  return <Home />;\n};\n\nReactDOM.render(\n  <StrictMode>\n    <App />\n  </StrictMode>,\n  document.querySelector('main'),\n);\n"],"sourceRoot":""}