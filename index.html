<!DOCTYPE html>
<html>
  <head>
    <title>LINZ Address Import</title>
    <meta charset="UTF-8" />
    <style>
      * {
        font-family: Arial, Helvetica, sans-serif;
      }
      table,
      td {
        border-collapse: collapse;
        border: 1px solid #000;
      }
    </style>
  </head>
  <body>
    <table>
      <tr style="font-weight: 800">
        <td>Data Category</td>
        <td>No. of addresses</td>
        <td>Percentage of total</td>
        <td>How to action</td>
        <td>Raw data</td>
      </tr>
    </table>

    <p></p>

    <footer>
      For more infomation, see
      <a
        href="https://wiki.openstreetmap.org/wiki/Import/New_Zealand_Street_Addresses_(2021)"
        >the wiki page</a
      >
      and
      <a href="https://github.com/osm-nz/linz-address-import">the repository</a>
    </footer>
    <script>
      const CDN_BASE_URL = "https://cdn.linz-addr.kyle.kiwi";
      async function main() {
        const { date, count, total } = await fetch(
          CDN_BASE_URL + "/stats.json"
        ).then((r) => r.json());

        document.querySelector("p").innerHTML =
          "Statistics last updated on " + new Date(date);

        const META = {
          PERFECT: ["Data is already perfect", "No action required"],
          EXISTS_BUT_WRONG_DATA: [
            "Address exists but the data is wrong",
            "TBC",
            "data-wrong.txt",
          ],
          EXISTS_BUT_NO_LINZ_REF: [
            "Address exists but no linz ref",
            "TBC",
            "needs-linz-ref.txt",
          ],
          MULTIPLE_EXIST_BUT_NO_LINZ_REF: [
            "Multiple addresses exists, none have linz ref",
            "TBC",
            "needs-linz-ref-but-multiple.txt",
          ],
          MULTIPLE_EXIST: [
            "Multiple addresses exists with same linz ref",
            "TBC",
            "duplicate-linz-ref.txt",
          ],
          TOTALLY_MISSING: [
            "Addresses totally missing from OSM",
            '<a href="./rapid/">âœ¨ Click to start mapping</a>',
          ],
          NEEDS_DELETE: [
            "Addresses in OSM that have been deleted by LINZ",
            "As above, select a suburb. Addresses to be deleted will be shown in red.",
            "needs-delete.txt",
          ],
          EXISTS_BUT_LOCATION_WRONG: [
            "Addresses exist but location is very wrong",
            'As above but select the suburb called "ZZ Special Location Wrong".',
            "location-wrong.txt",
          ],
          UNKNOWN_ERROR: [
            "Unknown Error",
            "Something went wrong during conflating that the system doesn't understand.",
            "unknown-error.txt",
          ],
          NEEDS_DELETE_NON_TRIVIAL: [
            "Addresses in OSM that have been deleted by LINZ, but are on a OSM building or business",
            "manual action required",
            "needs-delete-non-trivial.txt",
          ],
          CORRUPT: [
            "There are multiple LINZ refs on the same OSM node",
            "manual action required",
            "corrupt.txt",
          ],
          LINZ_REF_CHANGED: [
            "LINZ has changed their ID for an address, but not the data",
            "manual action required",
            "linz-ref-changed.txt",
          ],
        };

        const table = document.querySelector("table");

        for (const status in count) {
          table.innerHTML += `<tr>
            <td>${META[status][0]}</td>
            <td>${count[status].toLocaleString()}</td>
            <td>${((count[status] / total) * 100).toFixed(2)}%</td>
            <td>${META[status][1]}</td>
            ${
              META[status][2]
                ? `<td><a href="${CDN_BASE_URL}/${META[status][2]}">download</a></td>`
                : ""
            }
          </tr>`;
        }
      }
      main();
    </script>
  </body>
</html>
